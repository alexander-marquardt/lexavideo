    <!-- Because we have multiple chat boxes that can all be "open" at once (although only one
         will be visible at any time), we need to keep all of the chatboxes in the dom irregardless
         of whatever view is being currently displayed. This allows each box to continue to receive
         messages which will be shown whenever the user displays any chatbox.

         Therefore, when chatbox URLs are selected,  the ngView that is shown is blank and one of
         the chat panels defined in the lx-chatbox.html file will be enabled, depending on the
         current URL (where the URL contains the chat name).

         When a chatbox URL is not selected, we must hide all chatboxes. This is accomplished by
         making sure that chatRoomNameFromUrl is not set.
         -->

{% from 'lx-templates/lx-macros.html' import moveAndResizeDivBesideMainMenu %}
{% from 'lx-templates/lx-macros.html' import removeSpaceBetwenMainMenuAndDivBesideMainMenu %}

<div ng-controller="lxChatRoomCtrl">

        <div ng-show="chatRoomDisplayObject.chatRoomNameFromUrl" class="cl-fade-in-chatbox-view">
            {{ moveAndResizeDivBesideMainMenu() }}

                {{ removeSpaceBetwenMainMenuAndDivBesideMainMenu() }}
                {% raw %}

                    <div ng-repeat="(normalizedChatRoomName, roomOccupancyObject) in roomOccupancyDict">
                        <div ng-controller="lxChatPanelCtrl">

                            <!-- The following ng-show ensures that only the currently selected chatbox is visible to the
                                 client.

                                 Note: the ng-show below causes a small delay (probably about 500ms) that prevents
                                 a portion of the cl-fade-in-chatbox-view animation (above) from fully displaying
                                 when a new room is created (the animation is already almost done by the time this
                                 element is shown).

                                 I believe that this delay is caused from waiting for the server to respond with
                                 an updated roomOccupancyDict object that contains the room that the user is currently
                                 viewing.
                                 -->
                            <div class="panel cl-chat-panel panel-primary"
                                 ng-show="chatPanelDict[roomOccupancyObject.chatRoomId].chatPanelIsCurrentlyVisible">

                                <div class="col-xs-12 panel-heading  cl-chat-panel-heading text-center">

                                    <!-- define the open chats button -->
                                    <div class="btn-group pull-left"
                                         ng-class="dropdownMenusStatuses.openChatsDropdownIsOpen ? 'open': ''">
                                        <button type="button" class="btn btn-primary"
                                                ng-click="dropdownMenusStatuses.openChatsDropdownIsOpen=!dropdownMenusStatuses.openChatsDropdownIsOpen">
                                            <span style="display:inline-block;line-height:1em;">
                                                <span class="icon-lx-chat-bubble-dual" style="display:inline-block;line-height:1em;"></span>
                                            </span>
                                            <span ng-if="trackUnseenMessageCountObject.unseenMessageCount">
                                                {{ trackUnseenMessageCountObject.unseenMessageCount }}
                                            </span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu cl-chat-panel-dropdown " role="menu">
                                            <li ng-repeat="normalizedChatRoomName in normalizedRoomNamesList | orderBy: simpleArrayOrderByFn">

                                                    <a href="/{{ roomOccupancyDict[normalizedChatRoomName].chatRoomNameAsWritten }}">
                                                        <span ng-if="chatPanelDict[roomOccupancyDict[normalizedChatRoomName].chatRoomId].numMessagesSinceLastTimeBottomOfPanelWasViewed">
                                                            [{{ chatPanelDict[roomOccupancyDict[normalizedChatRoomName].chatRoomId].numMessagesSinceLastTimeBottomOfPanelWasViewed }}]
                                                        </span>

                                                        <span style="white-space:nowrap;">
                                                            &nbsp;{{ roomOccupancyDict[normalizedChatRoomName].chatRoomNameAsWritten }}&nbsp
                                                        </span>
                                                    </a>
                                            </li>
                                        </ul>
                                    </div>


                                    <span class="cl-chat-panel-name-size">
                                        {{ chatRoomDisplayObject.chatRoomNameFromUrl }}
                                    </span>
                                    <span class="cl-chat-panel-name-size" ng-if="chatPanelDict[roomOccupancyObject.chatRoomId].numMessagesSinceLastTimeBottomOfPanelWasViewed">
                                        [{{ chatPanelDict[roomOccupancyObject.chatRoomId].numMessagesSinceLastTimeBottomOfPanelWasViewed }}]
                                    </span>

                                    <!-- define the group members button -->
                                    <div class="btn-group pull-right"
                                         ng-class="dropdownMenusStatuses.groupMembersDropdownIsOpen ? 'open': ''">
                                        <button type="button" class="btn btn-primary"
                                                ng-click="dropdownMenusStatuses.groupMembersDropdownIsOpen=!dropdownMenusStatuses.groupMembersDropdownIsOpen">
                                        <span style="display:inline-block;line-height:1em;">
                                            <span class="icon-lx-users" style="display:inline-block;line-height:1em;"></span>
                                        </span>
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu cl-chat-panel-dropdown " role="menu">
                                            <li ng-repeat="remoteClientObj in roomOccupancyObject.listOfClientObjects | orderBy: 'userName'">
                                                <span style="white-space:nowrap;">
                                                    <span  class='cl-chat-group-video-icon-container'>
                                                        <button type="button"
                                                            class="btn btn-sm btn-primary cl-chat-group-video-button-modifier"
                                                            ng-click="showVideoElementsAndStartVideoFn('enableVideoExchange', true, remoteClientObj.clientId)"
                                                            >
                                                            <span class="icon-lx-video-camera-filled"></span>
                                                        </button>
                                                    </span>
                                                    {{ remoteClientObj.userName }}
                                                </span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="panel-body cl-chat-panel-body cl-chat-panel-body-short"
                                     scroll-glue="chatPanelDict[roomOccupancyObject.chatRoomId].chatPanelIsGlued">
                                     <!--ng-class="videoExchangeSettingsObject.localVideoEnabledSetting == 'enableVideoExchange' ?-->
                                        <!--'cl-chat-panel-body-short' : 'cl-chat-panel-body-tall'">-->
                                    <!--<div ng-class="videoExchangeSettingsObject.localVideoEnabledSetting == 'enableVideoExchange' ?-->
                                        <!--'cl-dummy-blank-div-in-short-chat-panel' : 'cl-dummy-blank-div-in-tall-chat-panel'"></div>-->
                                    <div ng-class="'cl-dummy-blank-div-in-short-chat-panel'"></div>



                                    <div lx-show-chat-messages-directive></div>


                                    <div ng-repeat="(remoteClientId, videoExchangeObject) in videoExchangeObjectsDict">
                                        <!-- This is the html that prompts the user to exchange video with the remote user if the
                                             remote user has requested to do so -->
                                        <div class="well cl-show-hide-fade cl-prompt-for-video-access"
                                             ng-show="videoExchangeObject.remoteVideoEnabledSetting == 'enableVideoExchange' &&
                                                      videoExchangeObject.localVideoEnabledSetting == 'waitingForEnableVideoExchangePermission'">

                                            <div class="row ">
                                                <div class="col-xs-12 cl-text-size-1_5em ">
                                                    <div>Remote user has requested to exchange video. Do you accept?</div>


                                                    <button type="button"
                                                            class="btn btn-sm btn-primary"
                                                            ng-click="showVideoElementsAndStartVideoFn('enableVideoExchange', false, remoteClientId)">
                                                    <span class="icon-lx-start-video-camera-wrapper-cfg">
                                                        <span class="icon-lx-start-video-camera-cfg"></span>
                                                    </span>
                                                        Start
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-sm btn-primary"
                                                            ng-click="showVideoElementsAndStartVideoFn('doNotEnableVideoExchange', false, remoteClientId)">
                                                    <span class="icon-lx-start-video-camera-wrapper-cfg">
                                                        <span class="icon-lx-start-video-camera-cfg"></span>
                                                        <span class="icon-lx-deny-start-video-camera-thick-forward-slash-cfg"></span>
                                                        <span class="icon-lx-deny-start-video-camera-thin-forward-slash-cfg"></span>
                                                    </span>
                                                        Deny
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-footer cl-chat-panel-footer">
                                    <div class="row">

                                        <!-- Chat message input and send message button -->
                                        <div class="col-xs-12">
                                            <form name="sendMessageForm" role="form" novalidate>
                                                <div class="input-group">
                                                    <input class="form-control input-sm"
                                                           name="messageInputElem"
                                                           placeholder="Type your message here..."
                                                           ng-model="sendMessageFormScope.inputMessageString"
                                                           maxlength="{{ maxMsgLength }}"
                                                           ng-click="gluePanel()"
                                                           required
                                                            />



                                                    <span class="input-group-btn">
                                                        <button ng-click="sendChatMessageFn(roomOccupancyDict[chatRoomDisplayObject.normalizedChatRoomNameFromUrl].chatRoomId)"
                                                                class="btn  btn-sm pull-right  'btn-primary'"
                                                                ng-disabled="sendMessageForm.$invalid">
                                                            Send
                                                        </button>
                                                    </span>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
</div>

{% endraw %}

