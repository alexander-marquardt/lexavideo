
<script type='text/javascript'>
    var videoConstantsEmbeddedInHtml = {{ serverVideoParamsJson }}
</script>

{% raw %}

<div ng-controller="lxChatRoomOuterCtrl">


    <!-- the following ng-if statement ensures that in the case that we have to redirect the user back to the landing page
         that the modal boxes and camera prompts and other things have not already started to execute -->
    <div ng-if="lxChatRoomOuterCtrl.userSuccessfullyEnteredRoom == true">

        {% endraw %}{% include "lx-templates/lx-jinja-templates/lx-tc-check-if-system-supports-web-rtc.html" %}{% raw %}
        <div lx-check-if-system-supports-web-rtc></div>


        <div ng-controller="lxMainVideoCtrl">



            <div lx-initialize-channel-and-turn-directive></div>

            {% endraw %}{% include "lx-templates/lx-jinja-templates/lx-tc-access-camera.html" %}{% raw %}
            <div lx-access-camera-and-microphone-directive></div>

            <div class="row">
                <div lx-video-container-directive>

                    <div lx-video-wrapper-directive video-window='local' class="col-sm-6" id="id-local-video-wrapper-div">
                        <div class="text-center">
                            <div ng-show="(videoSignalingObject.localIsSendingVideoType == 'HD Video' ||  !videoSignalingObject.localIsSendingVideoType) || videoSignalingObject.debugShowAllVideoWindows" >
                                <h4>Local HD Video</h4>
                                <div style="display:inline-block" class="cl-my-well" >
                                    <div style="position: relative">
                                        <div lx-video-element-directive video-window='local'></div>
                                        <div lx-video-settings-negotiation-directive class="cl-hide-on-larger-than-xs"></div>
                                    </div>
                                </div>
                            </div>

                            <div lx-generate-ascii-video-directive id="id-local-ascii-video-wrapper-div"
                                 ng-show="(videoSignalingObject.localIsSendingVideoType == 'ASCII Video') || videoSignalingObject.debugShowAllVideoWindows" >
                                <h4>Local ASCII Video</h4>
                                <div class="cl-my-well" style="display:inline-block" >
                                    <div style="position: relative">
                                        <!-- Do not move the span to a different line than the pre - the formatting will change if this is done since a blank will be added before the span. -->
                                        <pre class="cl-ascii-container cl-video-sizing"><span class="cl-ascii-drawing-text cl-ascii-normal-span">
                                        </span></pre>
                                        <div lx-video-settings-negotiation-directive class="cl-hide-on-larger-than-xs"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="btn-group">
                                <button type="button" class="btn btn-sm"
                                        ng-class="(videoSignalingObject.localHasSelectedVideoType == 'HD Video') ? 'btn-primary disabled' : 'btn-default'"
                                        ng-click="setLocalVideoType('HD Video')">HD Video</button>
                                <button type="button" class="btn btn-sm"
                                        ng-class="(videoSignalingObject.localHasSelectedVideoType == 'ASCII Video') ? 'btn-primary disabled' : 'btn-default'"
                                        ng-click="setLocalVideoType('ASCII Video')">ASCII Video</button>
                            </div>
                        </div>
                    </div>


                    <div lx-video-wrapper-directive video-window='remote' class="col-sm-6" id="id-remote-video-wrapper-div">
                        <div lx-mini-video-template-directive></div>
                        <div class="text-center" >
                            <div ng-controller="lxVideoNegotiationCtrl">
                                <div id="id-remote-hd-video-wrapper-div"
                                     ng-show="videoSignalingObject.remoteIsSendingVideoType == 'HD Video' ||
                                     (!videoSignalingObject.remoteIsSendingVideoType && videoSignalingObject.localHasSelectedVideoType == 'HD Video') ||
                                     videoSignalingObject.debugShowAllVideoWindows">
                                    <h4>Remote HD Video</h4>

                                    <div  class="cl-my-well" style="display:inline-block">
                                        <div style="position: relative">
                                            <div lx-video-element-directive video-window='remote'></div>
                                            <div lx-video-settings-negotiation-directive></div>
                                        </div>
                                    </div>
                                </div>

                                <div lx-draw-remote-ascii-video-directive id="id-remote-ascii-video-wrapper-div"
                                     ng-show="(videoSignalingObject.remoteIsSendingVideoType == 'ASCII Video') ||
                                     (!videoSignalingObject.remoteIsSendingVideoType && videoSignalingObject.localHasSelectedVideoType == 'ASCII Video') ||
                                     videoSignalingObject.debugShowAllVideoWindows">
                                    <h4>Remote ASCII Video</h4>
                                    <div style="display:inline-block" class="cl-my-well">
                                        <div style="position: relative">
                                            <!-- Do not move the span to a different line than the pre - the formatting will change if this is done since a blank will be added before the span. -->
                                            <pre class = "cl-ascii-container cl-video-sizing"><span class="cl-ascii-drawing-text cl-ascii-normal-span">
                                            </span></pre>
                                            <div lx-video-settings-negotiation-directive></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class = "cl-hide-on-larger-than-xs">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm"
                                            ng-class="(videoSignalingObject.localHasSelectedVideoType == 'HD Video') ? 'btn-primary disabled' : 'btn-default'"
                                            ng-click="setLocalVideoType('HD Video')">HD Video</button>
                                    <button type="button" class="btn btn-sm"
                                            ng-class="(videoSignalingObject.localHasSelectedVideoType == 'ASCII Video') ? 'btn-primary disabled' : 'btn-default'"
                                            ng-click="setLocalVideoType('ASCII Video')">ASCII Video</button>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>

                <div lx-monitor-control-keys-directive ></div>
            </div>

            <div ng-if="debugBuildEnabled">
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>Room Name: {{ roomName }}</td>
                        <td>Room Id:   {{ roomId }}</td>
                    </tr>
                    <tr>
                        <td>User Name: {{ userName }}</td>
                        <td>Remote User Id: {{ videoSignalingObject.remoteUserId }}</td>
                    </tr>
                    <tr>
                        <td>localHasSelectedVideoType: {{ videoSignalingObject.localHasSelectedVideoType }}</td>
                        <td>localIsNegotiatingForVideoType: {{ videoSignalingObject.localIsNegotiatingForVideoType }}</td>
                    </tr>
                    <tr>
                        <td>localIsSendingVideoType: {{ videoSignalingObject.localIsSendingVideoType }}</td>
                        <td>remoteIsSendingVideoType: {{ videoSignalingObject.remoteIsSendingVideoType }}</td>
                    </tr>
                    <tr>
                        <td>remoteVideoSignalingStatus.settingsType: {{ videoSignalingObject.remoteVideoSignalingStatus.settingsType }}</td>
                        <td>remoteVideoSignalingStatus.videoType: {{ videoSignalingObject.remoteVideoSignalingStatus.videoType }}</td>
                    </tr>
                </table>
            </div>

            <!-- Footer div is at the bottom of the page, but is placed here so that it
            has access to the main-video-ctrl scope -->

            <nav lx-call-status-directive class="navbar navbar-inverse navbar-fixed-bottom"></nav>
        </div>
    </div>
</div>

{% endraw %}